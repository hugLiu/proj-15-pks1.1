<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>作业项目进展情况统计图_Child</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection />
        <schema />
        <table />
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2017/08/30 10:34:59.571</created_date>
    <modified_user>-</modified_user>
    <modified_date>2017/08/30 10:34:59.571</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>exploration</name>
    <server>${Host}</server>
    <type>MSSQL</type>
    <access>Native</access>
    <database>sunshine2011</database>
    <port>${Port}</port>
    <username>${User}</username>
    <password>${Password}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${Port}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>AddHttpHeaders</from>
      <to>InvokeAppDataService</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GenerateTitle</from>
      <to>GenerateIndexerModel</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GenerateResourceKey</from>
      <to>ToJson</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GenerateAppDataModel</from>
      <to>AddHttpHeaders</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>InvokeAppDataService</from>
      <to>NormalizeDataId</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>NormalizeDataId</from>
      <to>GenerateTitle</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>ToJson</from>
      <to>GenerateContent</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GenerateContent</from>
      <to>GenerateAppDataModel</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GetTableFromDb</from>
      <to>GenerateResourceKey</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GenerateIndexerModel</from>
      <to>InvokeIndexerService</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>AddHttpHeaders</name>
    <type>Constant</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>content-type</name>
        <type>String</type>
        <format />
        <currency />
        <decimal />
        <group />
        <nullif>application/json</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>784</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GenerateAppDataModel</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var data = JSON.parse(outputValue).data[0];

key=data.key;


var appData = {
	content:"",
	contentType:"Json",
	dataid:"",
	generatefulltext:"true",
	generatethumbnail:"true",
	isonline:true,
	name:"",
	rawadapter:"",
	resourcekey:key,
	resourcetype:"",
	sourcefile:"",
	storagetype:"FileSystem",
	system:"勘探协同研究环境",
	uploader:"",
	uploadfileid:""
};

//var json = JSON.parse(outputValue);
//json = json.data[0];
//json = JSON.stringify(json);

appData.content = JSON.parse(content);

appData = JSON.stringify(appData);
</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>appData</name>
        <rename>appData</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GenerateContent</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var data = JSON.parse(outputValue).data;

var tableHeaders = [
{"field": "作业方式", "title": "作业方式", "type": "", "align": "center", "valign": "bottom"},
{"field": "工作名称", "title": "工作名称", "type": "", "align": "center", "valign": "bottom"},
{"field": "项目进度", "title": "项目进度", "type": "", "align": "center", "valign": "center"},
{"field": "计划", "title": "计划", "type": "", "align": "center", "valign": "bottom"},
{"field": "完成", "title": "完成", "type": "", "align": "center", "valign": "bottom"},
{"field": "完成率", "title": "完成率", "type": "", "align": "center", "valign": "bottom"}
];

var 自营二维地震完成率 = data[0].二维地震采集计划==0?0:((data[0].二维地震采集完成*100)/(data[0].二维地震采集计划));
自营二维地震完成率=Math.round(自营二维地震完成率)+"%";
var 自营二维进度 = 自营二维地震完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+自营二维地震完成率+';">&lt;div class="progress-value">'+自营二维地震完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 自营三维地震完成率 = data[0].三维地震采集计划==0?0:((data[0].三维地震采集完成*100)/(data[0].三维地震采集计划));
自营三维地震完成率=Math.round(自营三维地震完成率)+"%";
var 自营三维进度 = 自营三维地震完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+自营三维地震完成率+';">&lt;div class="progress-value">'+自营三维地震完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 自营探井完成率 = data[0].探井口数计划==0?0:((data[0].探井口数完成*100)/(data[0].探井口数计划));
自营探井完成率=Math.round(自营探井完成率)+"%";
var 自营探井进度 = 自营探井完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+自营探井完成率+';">&lt;div class="progress-value">'+自营探井完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 自营进尺完成率 = data[0].探井进尺计划==0?0:((data[0].探井进尺完成*100)/(data[0].探井进尺计划));
自营进尺完成率=Math.round(自营进尺完成率)+"%";
var 自营进尺进度 = 自营进尺完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+自营进尺完成率+';">&lt;div class="progress-value">'+自营进尺完成率+'&lt;/div>&lt;/div>&lt;/div>';


var 合作二维地震完成率 = data[1].二维地震采集计划==0?0:((data[1].二维地震采集完成*100)/(data[1].二维地震采集计划));
合作二维地震完成率=Math.round(合作二维地震完成率)+"%";
var 合作二维进度 = 合作二维地震完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+合作二维地震完成率+';">&lt;div class="progress-value">'+合作二维地震完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 合作三维地震完成率 = data[1].三维地震采集计划==0?0:((data[1].三维地震采集完成*100)/(data[1].三维地震采集计划));
合作三维地震完成率=Math.round(合作三维地震完成率)+"%";
var 合作三维进度 = 合作三维地震完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+合作三维地震完成率+';">&lt;div class="progress-value">'+合作三维地震完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 合作探井完成率 = data[1].探井口数计划==0?0:((data[1].探井口数完成*100)/(data[1].探井口数计划));
合作探井完成率=Math.round(合作探井完成率)+"%";
var 合作探井进度 = 合作探井完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+合作探井完成率+';">&lt;div class="progress-value">'+合作探井完成率+'&lt;/div>&lt;/div>&lt;/div>';

var 合作进尺完成率 = data[1].探井进尺计划==0?0:((data[1].探井进尺完成*100)/(data[1].探井进尺计划));
合作进尺完成率=Math.round(合作进尺完成率)+"%";
var 合作进尺进度 = 合作进尺完成率==0?0:'&lt;div class="progress">&lt;div class="progress-bar progress-bar-success active" style="width:'+合作进尺完成率+';">&lt;div class="progress-value">'+合作进尺完成率+'&lt;/div>&lt;/div>&lt;/div>';



var tableData=[
	{
	"作业方式":data[0].作业方式,
	"工作名称":"二维地震采集(km)",
	"项目进度":自营二维进度,
	"计划":data[0].二维地震采集计划,
	"完成":data[0].二维地震采集完成,
	"完成率":自营二维地震完成率
	},
	{
	"作业方式":data[0].作业方式,
	"工作名称":"三维地震采集(km²)",
	"项目进度":自营三维进度,
	"计划":data[0].三维地震采集计划,
	"完成":data[0].三维地震采集完成,
	"完成率":自营三维地震完成率
	},
	{
	"作业方式":data[0].作业方式,
	"工作名称":"探井口数(口)",
	"项目进度":自营探井进度,
	"计划":data[0].探井口数计划,
	"完成":data[0].探井口数完成,
	"完成率":自营探井完成率
	},
	{
	"作业方式":data[0].作业方式,
	"工作名称":"探井进尺(m)",
	"项目进度":自营进尺进度,
	"计划":data[0].探井进尺计划,
	"完成":data[0].探井进尺完成,
	"完成率":自营进尺完成率
	},
	{
	"作业方式":data[1].作业方式,
	"工作名称":"二维地震采集(km)",
	"项目进度":合作二维进度,
	"计划":data[1].二维地震采集计划,
	"完成":data[1].二维地震采集完成,
	"完成率":合作二维地震完成率
	},
	{
	"作业方式":data[1].作业方式,
	"工作名称":"三维地震采集(km²)",
	"项目进度":合作三维进度,
	"计划":data[1].三维地震采集计划,
	"完成":data[1].三维地震采集完成,
	"完成率":合作三维地震完成率
	},
	{
	"作业方式":data[1].作业方式,
	"工作名称":"探井口数(口)",
	"项目进度":合作探井进度,
	"计划":data[1].探井口数计划,
	"完成":data[1].探井口数完成,
	"完成率":合作探井完成率
	},
	{
	"作业方式":data[1].作业方式,
	"工作名称":"探井进尺(m)",
	"项目进度":合作进尺进度,
	"计划":data[1].探井进尺计划,
	"完成":data[1].探井进尺完成,
	"完成率":合作进尺完成率
	}
];

var table = {
	tablename:"作业项目情况进展图",
	headers:[],
	columns:tableHeaders,
	rows:tableData
};

var content = [table];

content = JSON.stringify(content);



</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>content</name>
        <rename>content</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>528</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GenerateIndexerModel</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var data = JSON.parse(outputValue).data[0];
var well=data.WELL;
key=data.key;

var index = {
	abstract:"",
	auditor:"",
	auditeddate:"",
	author:"",
	ba:"",
	basin:"",
	bd:"",
	bf:"",
	bp:"",
	bt:"",
	catalogue:"",
	cozone:"",
	createddate:"",
	dataid:dataid,
	dsn:"十大库",
	firstlevel:"",
	frequency:"",
	fulltext:"",
	iiid:"",
	indexeddate:"",
	miningarea:"",
	pageid:4,
	pc:"",
	period:"",
	project:"",
	pt:"作业项目进展情况图",
	resourcekey:key,
	secondlevel:"",
	showtype:"Table",
	status:"",
	subject:[],
	submitteddate:"",
	submitter:"",
	swa:"",
	system:"勘探协同研究环境",
	thumbnail:"",
	title:title,
	trap:"",
	well:""
};
index  = {metadatas:[index]};
index = JSON.stringify(index);

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>index</name>
        <rename>index</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GenerateResourceKey</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var key = "作业项目进展情况图2016";

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>key</name>
        <rename>key</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GenerateTitle</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var title = '作业项目进展情况图';





</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>title</name>
        <rename>title</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>800</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GetTableFromDb</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>exploration</connection>
    <sql>with
w as (
	(
	select '自营' as 作业方式 ,
	   sum(num) + sum(numUn) as 探井口数计划			 
		from (select distinct Ocean ,num,numUn from ReportSub_ExplorationSelfDeploy where TheYear=2017) as com
)
union
	(
	select '合作' as 作业方式 ,
	   sum(num) + sum(numUn) as 探井口数计划			 
		from (select distinct Ocean ,num,numUn from ReportSub_ExplorationCooperateDeploy where TheYear=2017) as com
	)
),
s2 as (
	(
	select '自营' as 作业方式 ,
	   sum(D2Collect) + SUM(D2CollectUn) as 二维地震采集计划		 
		from (select distinct Ocean ,D2Collect, D2CollectUn from ReportSub_ExplorationSelfDeploy where TheYear=2017) as com
)
union
	(
	select '合作' as 作业方式 ,
	   sum(D2Collect) + SUM(D2CollectUn) as 二维地震采集计划	 
		from (select distinct Ocean ,D2Collect, D2CollectUn from ReportSub_ExplorationCooperateDeploy where TheYear=2017) as com
	)
),
s3 as (
	(
	select '自营' as 作业方式 ,
	   sum(D3Collect) + sum(D3CollectUn) as 三维地震采集计划 
		from (select distinct Ocean ,D3Collect,D3CollectUn from ReportSub_ExplorationSelfDeploy where TheYear=2017) as com
)
union
	(
	select '合作' as 作业方式 ,
	   sum(D3Collect) + sum(D3CollectUn) as 三维地震采集计划
		from (select distinct Ocean ,D3Collect,D3CollectUn from ReportSub_ExplorationCooperateDeploy where TheYear=2017) as com
	)
),
a as (
	(
		select '自营' as 作业方式 ,
			   sum(ABS(Td_Plan)) + sum(ABS(Td_PlanUn)) as 探井进尺计划
		from (select distinct Ocean, Well , D2Collect, D2CollectUn,D3Collect,D3CollectUn,num,numUn,Td_Plan, Td_PlanUn from ReportSub_ExplorationSelfDeploy where TheYear=2017) as rese
	)
	union
	(
		select '合作' as 作业方式 ,
			   sum(ABS(Td_Plan)) + sum(ABS(Td_PlanUn)) as 探井进尺计划
		from (select distinct Well , D2Collect, D2CollectUn,D3Collect,D3CollectUn,num,numUn,Td_Plan, Td_PlanUn from ReportSub_ExplorationCooperateDeploy where TheYear=2017) as reco
	)
),
b as (
	select (case when op_mode_id like '%自%' then '自营' else '合作' end ) as 作业方式,
		   sum(full_area_month) as 二维地震采集完成
	from [10.138.0.83].ESDMS.dbo.Explore_TaskMonth
	where op_t_id like '%二维%' and year(Cur_Date) = 2017
	group by (case when op_mode_id like '%自%' then '自营' else '合作' end )
),
c as (
    select (case when op_mode_id like '%自%' then '自营' else '合作' end ) as 作业方式,
		   sum(full_area_month) as 三维地震采集完成
	from [10.138.0.83].ESDMS.dbo.Explore_TaskMonth
	where op_t_id like '%三维%' and year(Cur_Date) = 2017
	group by (case when op_mode_id like '%自%' then '自营' else '合作' end )
),
t as (
	select distinct well,op_mode_id, Well_Statute_ID from [10.138.0.83].ESDMS.dbo.GEO_basic
	where year(b_date) = 2017  
),
t1 as (
	select * from t where t.op_mode_id like '%自%'
),
t2 as (
	select * from t where t.op_mode_id like '%合%'
),
d as (
   select (case when t.op_mode_id like '%自%' then '自营' else '合作' end ) as 作业方式,
		  count(*) as 探井口数完成
   from t
   group by (case when t.op_mode_id like '%自%' then '自营' else '合作' end )
),
e as(
	select * from t
	where   Well_Statute_ID like '%油流%' 
			or 
			Well_Statute_ID like '%气流%'
			or
			Well_Statute_ID like '%油气流%'
),
f as (
   select (case when e.op_mode_id like '%自%' then '自营' else '合作' end ) as 作业方式,
		  count(*) as 油气流井数
   from e
   group by (case when e.op_mode_id like '%自%' then '自营' else '合作' end )
),
g as(
   (
	   select '自营' as 作业方式,
			  油气流井井名 = STUFF(
									(select ';'+ well from e where  e.op_mode_id like '%自%' for xml path('')),
									1,
									1,
									''
								 )
	   from e
   )
   union
   (
   select '合作' as 作业方式,
			  油气流井井名 = STUFF(
									(select ';'+ well from e where  e.op_mode_id not like '%自%' for xml path('')),
									1,
									1,
									''
								 )
	   from e
   )
),
h as (
	(
		select '自营' as 作业方式,
				sum(cur_ft) as 探井进尺完成
		from [10.138.0.83].ESDMS.dbo.Geo_taskdynamic
		where  well in (select well from t1)
	)
	union
	(
		select '合作' as 作业方式,
				sum(cur_ft) as 探井进尺完成
		from [10.138.0.83].ESDMS.dbo.Geo_taskdynamic
		where  well in (select well from t2)
	)
)
select a.作业方式,
	   ROUND(coalesce(s2.二维地震采集计划,0),2) as 二维地震采集计划,
	   ROUND(coalesce(b.二维地震采集完成,0),2) as 二维地震采集完成,
	   ROUND(coalesce(s3.三维地震采集计划,0),2) as 三维地震采集计划,
	   ROUND(coalesce(c.三维地震采集完成,0),2) as 三维地震采集完成,
	   ROUND(coalesce(w.探井口数计划,0),0) as 探井口数计划,
	   ROUND(coalesce(d.探井口数完成,0),0) as 探井口数完成,
	   ROUND(coalesce(a.探井进尺计划,0),2) as 探井进尺计划,
	   ROUND(coalesce(h.探井进尺完成,0),2) as 探井进尺完成,
	   coalesce(f.油气流井数,0) as 油气流井数,
	   g.油气流井井名
from a
left join b on a.作业方式 = b.作业方式
left join c on a.作业方式 = c.作业方式
left join d on a.作业方式 = d.作业方式
left join h on a.作业方式 = h.作业方式
left join f on a.作业方式 = f.作业方式
left join g on a.作业方式 = g.作业方式
left join w on a.作业方式 = w.作业方式
left join s2 on a.作业方式 = s2.作业方式
left join s3 on a.作业方式 = s3.作业方式</sql>
    <limit />
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>InvokeAppDataService</name>
    <type>HTTPPOST</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <postafile>N</postafile>
    <encoding>UTF-8</encoding>
    <url>${WebApiUrl}appdataservice/save</url>
    <urlInField>N</urlInField>
    <urlField />
    <requestEntity>appData</requestEntity>
    <httpLogin />
    <httpPassword>Encrypted </httpPassword>
    <proxyHost />
    <proxyPort />
    <socketTimeout>10000</socketTimeout>
    <connectionTimeout>10000</connectionTimeout>
    <closeIdleConnectionsTime />
    <lookup>
      <arg>
        <name>appData</name>
        <parameter>appData</parameter>
        <header>N</header>
      </arg>
      <arg>
        <name>content-type</name>
        <parameter>content-type</parameter>
        <header>Y</header>
      </arg>
    </lookup>
    <result>
      <name>result</name>
      <code />
      <response_time />
      <response_header />
    </result>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>912</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>InvokeIndexerService</name>
    <type>HTTPPOST</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <postafile>N</postafile>
    <encoding>UTF-8</encoding>
    <url>${WebApiUrl}indexerservice/insert</url>
    <urlInField>N</urlInField>
    <urlField />
    <requestEntity>index</requestEntity>
    <httpLogin />
    <httpPassword>Encrypted </httpPassword>
    <proxyHost />
    <proxyPort />
    <socketTimeout>10000</socketTimeout>
    <connectionTimeout>10000</connectionTimeout>
    <closeIdleConnectionsTime>-1</closeIdleConnectionsTime>
    <lookup>
      <arg>
        <name>index</name>
        <parameter>index</parameter>
        <header>N</header>
      </arg>
      <arg>
        <name>content-type</name>
        <parameter>content-type</parameter>
        <header>Y</header>
      </arg>
    </lookup>
    <result>
      <name>result</name>
      <code />
      <response_time />
      <response_header />
    </result>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>320</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>NormalizeDataId</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var dataid=JSON.parse(result).dataId;




</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>dataid</name>
        <rename>dataid</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>912</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ToJson</name>
    <type>JsonOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <outputValue>outputValue</outputValue>
    <jsonBloc>data</jsonBloc>
    <nrRowsInBloc>100</nrRowsInBloc>
    <operation_type>outputvalue</operation_type>
    <compatibility_mode>N</compatibility_mode>
    <encoding>UTF-8</encoding>
    <addtoresult>N</addtoresult>
    <file>
      <name>C:\Users\Percy\Desktop\122</name>
      <extention>js</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <create_parent_folder>N</create_parent_folder>
      <DoNotOpenNewFileInit>N</DoNotOpenNewFileInit>
      <servlet_output>N</servlet_output>
    </file>
    <fields>
      <field>
        <name>作业方式</name>
        <element>作业方式</element>
      </field>
      <field>
        <name>二维地震采集计划</name>
        <element>二维地震采集计划</element>
      </field>
      <field>
        <name>二维地震采集完成</name>
        <element>二维地震采集完成</element>
      </field>
      <field>
        <name>三维地震采集计划</name>
        <element>三维地震采集计划</element>
      </field>
      <field>
        <name>三维地震采集完成</name>
        <element>三维地震采集完成</element>
      </field>
      <field>
        <name>探井口数计划</name>
        <element>探井口数计划</element>
      </field>
      <field>
        <name>探井口数完成</name>
        <element>探井口数完成</element>
      </field>
      <field>
        <name>探井进尺计划</name>
        <element>探井进尺计划</element>
      </field>
      <field>
        <name>探井进尺完成</name>
        <element>探井进尺完成</element>
      </field>
      <field>
        <name>油气流井数</name>
        <element>油气流井数</element>
      </field>
      <field>
        <name>油气流井井名</name>
        <element>油气流井井名</element>
      </field>
      <field>
        <name>key</name>
        <element>key</element>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>432</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
